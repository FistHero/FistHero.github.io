"use strict";(self.webpackChunkfisthero_ui=self.webpackChunkfisthero_ui||[]).push([[924],{1361:function(e,r,n){n.d(r,{t:function(){return l},u:function(){return x}});var t=n(3032),a=n(4322),u=n.n(a),s=n(334),c=n(7998),i=n(56),o=n(1114),p=n(658),f=n.n(p),v=n(8955),d=n(1843);function x(){var e=(0,s.I1)(),r=(0,c.K)().account,n=(0,i.useQueryClient)();return(0,i.useQuery)(["queryHero",{account:r}],(0,t.Z)(u().mark((function a(){var s,c,i,p,x,l,h,g,b,m,w,k,y,T,I,q;return u().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(0,o.Kc)(e),(0,o.Kc)(r),a.next=4,e.getConfig(r);case 4:return s=a.sent,(0,v.f)("hero config",s),c=s.NFTIds,i=s.purchaseTokenApproved,p=s.sellingStartTime,x=s.isInWhitelist,l=s.nativeBalance,h=s.buyBoxTokenBalance,g=s.heroMainTokenBalance,b=s.boxes,m=s.airdropBoxes,w=i,k=f()(),y=p>0&&k.isAfter(p),T=c,a.next=13,e.checkFHTApproved();case 13:return I=a.sent,a.next=16,e.getInviteesInfo(r);case 16:return q=a.sent,a.abrupt("return",{config:s,isApproved:w,isWithinSellingPeriod:y,isInWhitelist:x,nftIds:T,nativeBalance:l,buyBoxTokenBalance:h,heroMainTokenBalance:g,boxes:b,airdropBoxes:m,DHTApproved:I,inviteesInfo:q,approve:function(){var r=(0,t.Z)(u().mark((function r(){var t;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t="",w){r.next=8;break}return r.next=4,e.approveToken();case 4:return t=r.sent,r.next=7,n.invalidateQueries("queryHero");case 7:d.Z.success({message:"Approve BUSD Succeed"});case 8:return r.abrupt("return",t);case 9:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),approveDHT:function(){var r=(0,t.Z)(u().mark((function r(){var t;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.approveDHT();case 2:return t=r.sent,r.next=5,n.invalidateQueries("queryHero");case 5:return r.abrupt("return",t);case 6:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),buyBoxesWithInviter:function(){var r=(0,t.Z)(u().mark((function r(t,a){var s;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.buyBoxesWithInviter(t,a);case 2:return s=r.sent,r.next=5,n.invalidateQueries("queryHero");case 5:return r.abrupt("return",s);case 6:case"end":return r.stop()}}),r)})));return function(e,n){return r.apply(this,arguments)}}(),buyAndOpenBoxesWithInviter:function(){var r=(0,t.Z)(u().mark((function r(t,a){var s;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(w){r.next=6;break}return r.next=3,e.approveToken();case 3:return r.next=5,n.invalidateQueries("queryHero");case 5:d.Z.success({message:"approve success"});case 6:if(y){r.next=11;break}return d.Z.error({message:"sell not start"}),r.abrupt("return",[]);case 11:return r.next=13,e.buyAndOpenBoxesWithInviter(t,a);case 13:return s=r.sent,r.next=16,n.invalidateQueries("queryHero");case 16:return r.abrupt("return",s);case 17:case"end":return r.stop()}}),r)})));return function(e,n){return r.apply(this,arguments)}}(),openBoxes:function(){var r=(0,t.Z)(u().mark((function r(t){var a;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.openBoxes(t);case 2:return a=r.sent,r.next=5,n.invalidateQueries("queryHero");case 5:return r.abrupt("return",a);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),mergeNFT:function(){var r=(0,t.Z)(u().mark((function r(t){var a;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if((0,v.f)(I),I){r.next=8;break}return d.Z.success({message:"start approve DHT"}),r.next=5,e.approveDHT();case 5:return r.next=7,n.invalidateQueries("queryHero");case 7:d.Z.success({message:"approve DHT succeed"});case 8:return r.next=10,e.mergeNFT(t);case 10:return a=r.sent,r.next=13,n.invalidateQueries("queryHero");case 13:return r.abrupt("return",a);case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),generateAttack:function(){var r=(0,t.Z)(u().mark((function r(){var t;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(0,v.f)("nftIds",T),r.next=3,e.generateAttack(T);case 3:return t=r.sent,r.next=6,n.invalidateQueries("queryHero");case 6:return r.abrupt("return",t);case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}()});case 18:case"end":return a.stop()}}),a)}))),{enabled:!!r&&!!e})}function l(){var e=(0,s.LM)(),r=(0,c.K)().account,n=(0,i.useQueryClient)();return(0,i.useQuery)(["queryWeapon",{account:r}],(0,t.Z)(u().mark((function a(){var s,c,i,p,x,l,h,g,b,m,w,k,y,T,I,q;return u().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(0,o.Kc)(e),(0,o.Kc)(r),a.next=4,e.getConfig(r);case 4:return s=a.sent,(0,v.f)("queryWeapon config",s),c=s.NFTIds,i=s.purchaseTokenApproved,p=s.sellingStartTime,x=s.isInWhitelist,l=s.nativeBalance,h=s.buyBoxTokenBalance,g=s.heroMainTokenBalance,b=s.boxes,m=s.airdropBoxes,w=i,k=f()(),y=p>0&&k.isAfter(p),T=c,a.next=13,e.checkFHTApproved();case 13:return I=a.sent,a.next=16,e.getInviteesInfo(r);case 16:return q=a.sent,a.abrupt("return",{config:s,isApproved:w,isWithinSellingPeriod:y,isInWhitelist:x,nftIds:T,nativeBalance:l,buyBoxTokenBalance:h,heroMainTokenBalance:g,boxes:b,airdropBoxes:m,DHTApproved:I,inviteesInfo:q,approve:function(){var r=(0,t.Z)(u().mark((function r(){var t;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t="",w){r.next=8;break}return r.next=4,e.approveToken();case 4:return t=r.sent,r.next=7,n.invalidateQueries("queryWeapon");case 7:d.Z.success({message:"Approve BUSD Succeed"});case 8:return r.abrupt("return",t);case 9:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),approveDHT:function(){var r=(0,t.Z)(u().mark((function r(){var t;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.approveDHT();case 2:return t=r.sent,r.next=5,n.invalidateQueries("queryWeapon");case 5:return r.abrupt("return",t);case 6:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),buyBoxesWithInviter:function(){var r=(0,t.Z)(u().mark((function r(t,a){var s;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.buyBoxesWithInviter(t,a);case 2:return s=r.sent,r.next=5,n.invalidateQueries("queryWeapon");case 5:return r.abrupt("return",s);case 6:case"end":return r.stop()}}),r)})));return function(e,n){return r.apply(this,arguments)}}(),buyAndOpenBoxesWithInviter:function(){var r=(0,t.Z)(u().mark((function r(t,a){var s;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(w){r.next=6;break}return r.next=3,e.approveToken();case 3:return r.next=5,n.invalidateQueries("queryWeapon");case 5:d.Z.success({message:"approve success"});case 6:if(y){r.next=11;break}return d.Z.error({message:"sell not start"}),r.abrupt("return",[]);case 11:return r.next=13,e.buyAndOpenBoxesWithInviter(t,a);case 13:return s=r.sent,r.next=16,n.invalidateQueries("queryWeapon");case 16:return r.abrupt("return",s);case 17:case"end":return r.stop()}}),r)})));return function(e,n){return r.apply(this,arguments)}}(),openBoxes:function(){var r=(0,t.Z)(u().mark((function r(t){var a;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.openBoxes(t);case 2:return a=r.sent,r.next=5,n.invalidateQueries("queryWeapon");case 5:return r.abrupt("return",a);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),mergeNFT:function(){var r=(0,t.Z)(u().mark((function r(t){var a;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if((0,v.f)(I),I){r.next=8;break}return d.Z.success({message:"start approve DHT"}),r.next=5,e.approveDHT();case 5:return r.next=7,n.invalidateQueries("queryWeapon");case 7:d.Z.success({message:"approve DHT succeed"});case 8:return r.next=10,e.mergeNFT(t);case 10:return a=r.sent,r.next=13,n.invalidateQueries("queryWeapon");case 13:return r.abrupt("return",a);case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),generateAttack:function(){var r=(0,t.Z)(u().mark((function r(){var t;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(0,v.f)("nftIds",T),r.next=3,e.generateAttack(T);case 3:return t=r.sent,r.next=6,n.invalidateQueries("queryWeapon");case 6:return r.abrupt("return",t);case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}()});case 18:case"end":return a.stop()}}),a)}))),{enabled:!!r&&!!e})}},1158:function(e,r,n){n.d(r,{o:function(){return m}});var t=n(3032),a=n(4322),u=n.n(a),s=n(334),c=n(7998),i=n(56),o=n(1114),p=n(8955),f=n(658),v=n.n(f),d=n(1635),x=n.n(d),l=n(9694),h=n.n(l),g=n(6446),b=n.n(g);function m(){var e="queryHeroGame",r=(0,s.T6)(),n=(0,c.K)().account,a=(0,i.useQueryClient)();return(0,i.useQuery)([e,{account:n}],(0,t.Z)(u().mark((function s(){var c,i,f,d,x,l,h,g,b,m,w,k,y,T,I,q,B,Z,Q;return u().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return(0,o.Kc)(r),(0,o.Kc)(n),s.next=4,r.getGameInfo(n);case 4:if(c=s.sent,i=c.squadIds,f=c.pendingRewards,d=c.fightInfos,x=c._pendingReward,l=c._lastClaimTime,h=c._rewardFee,(0,p.f)("hero game config",c),g={},b={heroSquadIndex:{},weaponSquadIndex:{}},!(i&&d&&d.length>0)){s.next=26;break}m=0;case 11:if(!(m<i.length)){s.next=26;break}if(d[m]){s.next=14;break}return s.abrupt("continue",23);case 14:for(w=c.squadIds[m],k=d[m].fightStartAt.mul(1e3).toNumber(),y=d[m].fightEndAt.mul(1e3).toNumber(),T=d[m].Heroes.map((function(e){return e.toString()})),I=d[m].Weapons.map((function(e){return e.toString()})),g[w]={fightStartTime:k,fightEndTime:y,isFighting:v()().isAfter(k)&&v()().isBefore(y),heroIds:T,weaponIds:I,fightPendingReward:f[m],fightClaimedReward:d[m].claimedReward,pendingReward:x,lastClaimTime:l.mul(1e3).toNumber(),rewardFee:h.toNumber(),attack:d[m].attack,gameId:d[m].gameId.toNumber()},q=0;q<T.length;q++)B=T[q],b.heroSquadIndex[B]=m+1;for(Z=0;Z<I.length;Z++)Q=I[Z],b.weaponSquadIndex[Q]=m+1;(0,p.f)("nftToSquadIndex",b);case 23:m++,s.next=11;break;case 26:return s.abrupt("return",{config:c,squadIdToFightInfo:g,nftToSquadIndex:b,createSquad:function(){var n=(0,t.Z)(u().mark((function n(t,s){var c;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.createSquad(t,s);case 2:return c=n.sent,n.next=5,a.invalidateQueries(e);case 5:return n.abrupt("return",c);case 6:case"end":return n.stop()}}),n)})));return function(e,r){return n.apply(this,arguments)}}(),fight:function(){var n=(0,t.Z)(u().mark((function n(t,s){var c;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.fight(t,s);case 2:return c=n.sent,n.next=5,a.invalidateQueries(e);case 5:return n.abrupt("return",c);case 6:case"end":return n.stop()}}),n)})));return function(e,r){return n.apply(this,arguments)}}(),deleteSquad:function(){var n=(0,t.Z)(u().mark((function n(t){var s;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.deleteSquad(t);case 2:return s=n.sent,n.next=5,a.invalidateQueries(e);case 5:return n.abrupt("return",s);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),transferSquadToPendingReward:function(){var n=(0,t.Z)(u().mark((function n(t){var s;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.transferSquadToPendingReward(t);case 2:return s=n.sent,n.next=5,a.invalidateQueries(e);case 5:return n.abrupt("return",s);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),claimFightReward:function(){var n=(0,t.Z)(u().mark((function n(){var t;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.claimFightReward();case 2:return t=n.sent,n.next=5,a.invalidateQueries(e);case 5:return n.abrupt("return",t);case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}()});case 27:case"end":return s.stop()}}),s)}))),{enabled:!!n&&!!r})}v().extend(x()),v().extend(h()),v().extend(b())}}]);